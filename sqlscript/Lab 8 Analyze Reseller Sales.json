{
	"name": "Lab 8 Analyze Reseller Sales",
	"properties": {
		"description": "Data Warehouse (Expected Duration 2 hours)\nDP-203T00-A Data Engineering on Microsoft Azure (2023) [No Azure Pass Required], Lab 08\n\nChallenge - Analyze reseller sales",
		"content": {
			"query": "SELECT  d.CalendarYear                AS Year,\n        pc.EnglishProductCategoryName AS ProductCategory,\n        g.EnglishCountryRegionName    AS Region,\n        SUM(i.SalesAmount)            AS InternetSalesAmount\nFROM FactInternetSales     AS i\nJOIN DimDate               AS d  ON i.OrderDateKey = d.DateKey\nJOIN DimCustomer           AS c  ON i.CustomerKey = c.CustomerKey\nJOIN DimGeography          AS g  ON c.GeographyKey = g.GeographyKey\nJOIN DimProduct            AS p  ON i.ProductKey = p.ProductKey\nJOIN DimProductSubcategory AS ps ON p.ProductSubcategoryKey = ps.ProductSubcategoryKey\nJOIN DimProductCategory    AS pc ON ps.ProductCategoryKey = pc.ProductCategoryKey\nGROUP BY d.CalendarYear, pc.EnglishProductCategoryName, g.EnglishCountryRegionName\nORDER BY Year, ProductCategory, Region;\n\n--Challenge 1\n--The total quantity of items sold per fiscal year and quarter.\nSELECT   d.FiscalYear\n       , d.FiscalQuarter\n       , SUM(r.OrderQuantity)  AS ItemsSold\nFROM     FactResellerSales     AS r\nJOIN     DimDate               AS d  ON r.OrderDateKey = d.DateKey\nGROUP BY d.FiscalYear\n       , d.FiscalQuarter\nORDER BY d.FiscalYear\n       , d.FiscalQuarter\n\n--Challenge 2\n--The total quantity of items sold per fiscal year, quarter, and sales territory region\n--associated with the employee who made the sale.\nSELECT   d.FiscalYear\n       , d.FiscalQuarter\n       , t.SalesTerritoryRegion\n       , SUM(r.OrderQuantity)  AS ItemsSold\nFROM     FactResellerSales     AS r\nJOIN     DimDate               AS d  ON r.OrderDateKey = d.DateKey\nJOIN     DimEmployee           AS e  ON r.EmployeeKey  = e.EmployeeKey\nJOIN     DimSalesTerritory     AS t  ON e.SalesTerritoryKey = t.SalesTerritoryKey\nGROUP BY d.FiscalYear\n       , d.FiscalQuarter\n       , t.SalesTerritoryRegion\nORDER BY d.FiscalYear\n       , d.FiscalQuarter\n       , t.SalesTerritoryRegion\n\n--Challenge 3\n--The total quantity of items sold per fiscal year, quarter,\n--and sales territory region by product category.\nSELECT   d.FiscalYear\n       , d.FiscalQuarter\n       , t.SalesTerritoryRegion\n       , c.EnglishProductCategoryName\n       , SUM(r.OrderQuantity)  AS ItemsSold\nFROM     FactResellerSales     AS r\nJOIN     DimDate               AS d  ON r.OrderDateKey = d.DateKey\nJOIN     DimProduct            AS p  ON r.ProductKey  = p.ProductKey\nJOIN     DimProductSubcategory AS s  ON p.ProductSubcategoryKey = s.ProductSubcategoryKey\nJOIN     DimProductCategory    AS c  ON s.ProductCategoryKey = c.ProductCategoryKey\nJOIN     DimEmployee           AS e  ON r.EmployeeKey  = e.EmployeeKey\nJOIN     DimSalesTerritory     AS t  ON e.SalesTerritoryKey = t.SalesTerritoryKey\nGROUP BY d.FiscalYear\n       , d.FiscalQuarter\n       , t.SalesTerritoryRegion\n       , c.EnglishProductCategoryName\nORDER BY d.FiscalYear\n       , d.FiscalQuarter\n       , t.SalesTerritoryRegion\n       , c.EnglishProductCategoryName\n\nselect top 10 * from FactResellerSales\nselect top 10 * from DimProduct where productsubcategorykey is not Null\nselect top 10 * from dimProductSubCategory\nselect top 10 * from DimProductCategory\n\n--Challenge 4\n--The rank of each sales territory per fiscal year based on total sales amount for the year.\nSELECT   d.FiscalYear\n       , t.SalesTerritoryRegion\n       , RANK() OVER(PARTITION BY t.SalesTerritoryRegion\n                    ORDER BY SUM(r.SalesAmount) DESC) AS RegionalRank\nFROM     FactResellerSales     AS r\nJOIN     DimDate               AS d  ON r.OrderDateKey = d.DateKey\nJOIN     DimEmployee           AS e  ON r.EmployeeKey  = e.EmployeeKey\nJOIN     DimSalesTerritory     AS t  ON e.SalesTerritoryKey = t.SalesTerritoryKey\nGROUP BY d.FiscalYear\n       , t.SalesTerritoryRegion\nORDER BY d.FiscalYear\n       , t.SalesTerritoryRegion\n\n--Challenge 5\n--The approximate number of sales order per year in each sales territory.\nSELECT   d.FiscalYear\n       , t.SalesTerritoryRegion\n       , APPROX_COUNT_DISTINCT(r.SalesOrderNumber) as ApproxOrders\nFROM     FactResellerSales     AS r\nJOIN     DimDate               AS d  ON r.OrderDateKey = d.DateKey\nJOIN     DimEmployee           AS e  ON r.EmployeeKey  = e.EmployeeKey\nJOIN     DimSalesTerritory     AS t  ON e.SalesTerritoryKey = t.SalesTerritoryKey\nGROUP BY d.FiscalYear\n       , t.SalesTerritoryRegion\nORDER BY d.FiscalYear\n       , t.SalesTerritoryRegion",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "sqlzavku1g",
				"poolName": "sqlzavku1g"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}